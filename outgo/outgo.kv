#:kivy 1.8.0

#:import Window kivy.core.window.Window

#:set col_number 3
#:set row_number 7

OutgoRoot

<OutgoRoot>:
    carousel: carousel
    input_widget: input_widget
    list_widget: list_widget

    Carousel:
        id: carousel
        width: Window.width
        height: Window.height
        loop: True
        InputWidget:
            id: input_widget
            model: app.outgo_model
        ListWidget:
            id: list_widget

<InputWidget>:
    orientation: "vertical"

    number_display: number_display
    category_spinner: category_spinner
    target_y: target_y
    target_n: target_n

    TextInput:
        id: number_display
        width: Window.width
        height: Window.height / row_number
        top: root.top
        text_size: self.size
        font_size: 36
        text: ''

    BoxLayout:
        orientation: "horizontal"
        height: Window.height / row_number

        TargetButton:
            id: target_y
            size_hint_x: 1 / 3
            height: Window.height / row_number
            text: 'y'
            state: 'down'
            on_press: root.select_y()

        Spinner:
            id: category_spinner
            size_hint_x: 2 / 3
            height: Window.height / row_number
            top: root.height * 6 / row_number
            font_size: 36
            text_autoupdate: True
            values: root.build_category()

    TargetButton:
        id: target_n
        top: root.height * 5 / row_number
        text: 'n'
        on_press: root.select_n()

    InputButton:
        id: number_btn_bs
        text: 'BS'
        right: root.width
        top: root.height * 5 / row_number
        on_press: root.backspace()

    GridLayout:
        cols: 3
        rows: 4

        InputButton:
            text: '1'
            on_press: root.input_number(self)

        InputButton:
            text: '2'
            on_press: root.input_number(self)

        InputButton:
            text: '3'
            on_press: root.input_number(self)

        InputButton:
            text: '4'
            on_press: root.input_number(self)

        InputButton:
            text: '5'
            on_press: root.input_number(self)

        InputButton:
            text: '6'
            on_press: root.input_number(self)

        InputButton:
            text: '7'
            on_press: root.input_number(self)

        InputButton:
            text: '8'
            on_press: root.input_number(self)

        InputButton:
            text: '9'
            on_press: root.input_number(self)

    InputButton:
        text: '0'
        right: root.width * 2 / col_number
        top: root.height * 5 / row_number
        on_press: root.input_number(self)

    Button:
        text: 'Enter'
        width: Window.width / 2
        height: Window.height / row_number
        font_size: 36
        right: root.width
        on_press: root.enter(app.root.carousel, app.root.list_widget)

    Button:
        text: 'Cancel'
        width: Window.width / 2
        height: Window.height / row_number
        font_size: 36
        right: root.width / 2
        on_press: root.cancel(app.root)

<ListWidget>:
    listview_widget: listview_widget
    Button:
        text: 'Select all'
        font_size: 24
        width: Window.width / 2
        height: Window.height / row_number
        top: root.top
        right: Window.width / 2
        on_press: root.select_all()
    Button:
        text: 'Pay off'
        font_size: 24
        width: Window.width / 2
        height: Window.height / row_number
        top: root.top
        right: Window.width
        on_press: root.pay_off()
    ListViewWidget:
        id: listview_widget
        model: app.outgo_model
        width: Window.width
        height: Window.height * 6 / row_number
        top: root.height * 6 / row_number
        adapter: self.build_adapter()

[ListItemWidget@SelectableView+BoxLayout]:
    list_item_label: list_item_label
    size_hint_y: None
    height: Window.height / row_number / 1.5
    ListItemLabelWidget:
        id: list_item_label
        text: self.print_item(ctx.data)
        text_size: self.size
        valign: 'middle'
        font_size: 18
    ListItemBtnWidget:
        text: 'Edit'
        selected_color: [0., 1., 0., 1]
        size_hint_x: 0.25
        font_size: 18
        on_press: self.move_to_input(app.root)
    ListItemBtnWidget:
        text: 'Del'
        selected_color: [0., 1., 0., 1]
        size_hint_x: 0.25
        font_size: 18
        on_press: self.move_to_input(app.root)

<ConfirmContent>:
    ConfirmLabel:
        top: root.height
        right: root.right / 2 - 10

<PopupButton@Button>:
    top: root.height / row_number + 55
    font_size: 24
    width: 140
    height: Window.height / row_number - 10

<ConfirmLabel@Label>:
    text: root.get_text()

<NumberButton@Button>:
    font_size: 36

<InputButton@Button>:
    font_size: 36
    width: Window.width / col_number
    height: Window.height / row_number

<TargetButton@ToggleButton>:
    font_size: 36
    width: Window.width / col_number
    height: Window.height / row_number
    group: 'target'
